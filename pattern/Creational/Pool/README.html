
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
  
  <!-- Licensed under the Apache 2.0 License -->
  <link rel="stylesheet" type="text/css" href="../../_static/fonts/open-sans/stylesheet.css" />
  <!-- Licensed under the SIL Open Font License -->
  <link rel="stylesheet" type="text/css" href="../../_static/fonts/source-serif-pro/source-serif-pro.css" />
  <link rel="stylesheet" type="text/css" href="../../_static/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="../../_static/css/bootstrap-theme.min.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
    <title>1.5. Pool &#8212; DesignPatternsPHP 1.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/guzzle.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="1.6. Prototype" href="../Prototype/README.html" />
    <link rel="prev" title="1.4. Multiton" href="../Multiton/README.html" />
  
   

  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../Prototype/README.html" title="1.6. Prototype"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../Multiton/README.html" title="1.4. Multiton"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../README.html">DesignPatternsPHP 1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../README.html" accesskey="U">1. Creational</a> &#187;</li> 
      </ul>
    </div>
    <div class="container-wrapper">

      <div id="mobile-toggle">
        <a href="#"><span class="glyphicon glyphicon-align-justify" aria-hidden="true"></span></a>
      </div>
  <div id="left-column">
    <div class="sphinxsidebar"><a href="
    ../../README.html" class="text-logo">DesignPatternsPHP</a>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <h2>Table Of Contents</h2>
  </div>
  <div class="sidebar-toc">
    
    
      <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../README.html">1. Creational</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../AbstractFactory/README.html">1.1. Abstract Factory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Builder/README.html">1.2. Builder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../FactoryMethod/README.html">1.3. Factory Method</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Multiton/README.html">1.4. Multiton</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">1.5. Pool</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Prototype/README.html">1.6. Prototype</a></li>
<li class="toctree-l2"><a class="reference internal" href="../SimpleFactory/README.html">1.7. Simple Factory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Singleton/README.html">1.8. Singleton</a></li>
<li class="toctree-l2"><a class="reference internal" href="../StaticFactory/README.html">1.9. Static Factory</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../Structural/README.html">2. Structural</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Behavioral/README.html">3. Behavioral</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../More/README.html">4. More</a></li>
</ul>

    
  </div>
</div>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <div id="main-search">
      <form class="form-inline" action="../../search.html" method="GET" role="form">
        <div class="input-group">
          <input name="q" type="text" class="form-control" placeholder="Search...">
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div>
      
    </div>
  </div>
        <div id="right-column">
          
          <div role="navigation" aria-label="breadcrumbs navigation">
            <ol class="breadcrumb">
              <li><a href="../../README.html">Docs</a></li>
              
                <li><a href="../README.html">1. Creational</a></li>
              
              <li>1.5. Pool</li>
            </ol>
          </div>
          
          <div class="document clearer body">
            
  <div class="section" id="pool">
<h1>1.5. <a class="reference external" href="http://en.wikipedia.org/wiki/Object_pool_pattern">Pool</a><a class="headerlink" href="#pool" title="Permalink to this headline">¶</a></h1>
<div class="section" id="purpose">
<h2>1.5.1. Purpose<a class="headerlink" href="#purpose" title="Permalink to this headline">¶</a></h2>
<p>The <strong>object pool pattern</strong> is a software creational design pattern that
uses a set of initialized objects kept ready to use – a “pool” – rather
than allocating and destroying them on demand. A client of the pool will
request an object from the pool and perform operations on the returned
object. When the client has finished, it returns the object, which is a
specific type of factory object, to the pool rather than destroying it.</p>
<p>Object pooling can offer a significant performance boost in situations
where the cost of initializing a class instance is high, the rate of
instantiation of a class is high, and the number of instances in use at
any one time is low. The pooled object is obtained in predictable time
when creation of the new objects (especially over network) may take
variable time.</p>
<p>However these benefits are mostly true for objects that are expensive
with respect to time, such as database connections, socket connections,
threads and large graphic objects like fonts or bitmaps. In certain
situations, simple object pooling (that hold no external resources, but
only occupy memory) may not be efficient and could decrease performance.</p>
</div>
<div class="section" id="uml-diagram">
<h2>1.5.2. UML Diagram<a class="headerlink" href="#uml-diagram" title="Permalink to this headline">¶</a></h2>
<img alt="Alt Pool UML Diagram" class="align-center" src="../../_images/uml16.png" />
</div>
<div class="section" id="code">
<h2>1.5.3. Code<a class="headerlink" href="#code" title="Permalink to this headline">¶</a></h2>
<p>You can also find this code on <a class="reference external" href="https://github.com/domnikl/DesignPatternsPHP/tree/master/Creational/Pool">GitHub</a></p>
<p>WorkerPool.php</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\Pool</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">WorkerPool</span> <span class="k">implements</span> <span class="nx">\Countable</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @var StringReverseWorker[]</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nv">$occupiedWorkers</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="sd">/**</span>
<span class="sd">     * @var StringReverseWorker[]</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nv">$freeWorkers</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">get</span><span class="p">()</span><span class="o">:</span> <span class="nx">StringReverseWorker</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">freeWorkers</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$worker</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">StringReverseWorker</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$worker</span> <span class="o">=</span> <span class="nb">array_pop</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">freeWorkers</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">occupiedWorkers</span><span class="p">[</span><span class="nb">spl_object_hash</span><span class="p">(</span><span class="nv">$worker</span><span class="p">)]</span> <span class="o">=</span> <span class="nv">$worker</span><span class="p">;</span>

        <span class="k">return</span> <span class="nv">$worker</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">dispose</span><span class="p">(</span><span class="nx">StringReverseWorker</span> <span class="nv">$worker</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$key</span> <span class="o">=</span> <span class="nb">spl_object_hash</span><span class="p">(</span><span class="nv">$worker</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">occupiedWorkers</span><span class="p">[</span><span class="nv">$key</span><span class="p">]))</span> <span class="p">{</span>
            <span class="nb">unset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">occupiedWorkers</span><span class="p">[</span><span class="nv">$key</span><span class="p">]);</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">freeWorkers</span><span class="p">[</span><span class="nv">$key</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$worker</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">count</span><span class="p">()</span><span class="o">:</span> <span class="nx">int</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">occupiedWorkers</span><span class="p">)</span> <span class="o">+</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">freeWorkers</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>StringReverseWorker.php</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\Pool</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">StringReverseWorker</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @var \DateTime</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nv">$createdAt</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createdAt</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\DateTime</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">run</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$text</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nb">strrev</span><span class="p">(</span><span class="nv">$text</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="test">
<h2>1.5.4. Test<a class="headerlink" href="#test" title="Permalink to this headline">¶</a></h2>
<p>Tests/PoolTest.php</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\Pool\Tests</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">DesignPatterns\Creational\Pool\WorkerPool</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PoolTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testCanGetNewInstancesWithGet</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$pool</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WorkerPool</span><span class="p">();</span>
        <span class="nv">$worker1</span> <span class="o">=</span> <span class="nv">$pool</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
        <span class="nv">$worker2</span> <span class="o">=</span> <span class="nv">$pool</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertCount</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nv">$pool</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertNotSame</span><span class="p">(</span><span class="nv">$worker1</span><span class="p">,</span> <span class="nv">$worker2</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testCanGetSameInstanceTwiceWhenDisposingItFirst</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$pool</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WorkerPool</span><span class="p">();</span>
        <span class="nv">$worker1</span> <span class="o">=</span> <span class="nv">$pool</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
        <span class="nv">$pool</span><span class="o">-&gt;</span><span class="na">dispose</span><span class="p">(</span><span class="nv">$worker1</span><span class="p">);</span>
        <span class="nv">$worker2</span> <span class="o">=</span> <span class="nv">$pool</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertCount</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nv">$pool</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="nv">$worker1</span><span class="p">,</span> <span class="nv">$worker2</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>


          </div>
            
  <div class="footer-relations">
    
      <div class="pull-left">
        <a class="btn btn-default" href="../Multiton/README.html" title="previous chapter (use the left arrow)">1.4. Multiton</a>
      </div>
    
      <div class="pull-right">
        <a class="btn btn-default" href="../Prototype/README.html" title="next chapter (use the right arrow)">1.6. Prototype</a>
      </div>
    </div>
    <div class="clearer"></div>
  
        </div>
        <div class="clearfix"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../Prototype/README.html" title="1.6. Prototype"
             >next</a> |</li>
        <li class="right" >
          <a href="../Multiton/README.html" title="1.4. Multiton"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../README.html">DesignPatternsPHP 1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../README.html" >1. Creational</a> &#187;</li> 
      </ul>
    </div>
<script type="text/javascript">
  $("#mobile-toggle a").click(function () {
    $("#left-column").toggle();
  });
</script>
<script type="text/javascript" src="../../_static/js/bootstrap.js"></script>
  <div class="footer">
    &copy; Copyright 2015, Dominik Liebler and contributors. Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div>
  </body>
</html>