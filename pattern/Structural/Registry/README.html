
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
  
  <!-- Licensed under the Apache 2.0 License -->
  <link rel="stylesheet" type="text/css" href="../../_static/fonts/open-sans/stylesheet.css" />
  <!-- Licensed under the SIL Open Font License -->
  <link rel="stylesheet" type="text/css" href="../../_static/fonts/source-serif-pro/source-serif-pro.css" />
  <link rel="stylesheet" type="text/css" href="../../_static/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="../../_static/css/bootstrap-theme.min.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
    <title>2.11. Registry &#8212; DesignPatternsPHP 1.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/guzzle.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="3. Behavioral" href="../../Behavioral/README.html" />
    <link rel="prev" title="2.10. Proxy" href="../Proxy/README.html" />
  
   

  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../Behavioral/README.html" title="3. Behavioral"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../Proxy/README.html" title="2.10. Proxy"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../README.html">DesignPatternsPHP 1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../README.html" accesskey="U">2. Structural</a> &#187;</li> 
      </ul>
    </div>
    <div class="container-wrapper">

      <div id="mobile-toggle">
        <a href="#"><span class="glyphicon glyphicon-align-justify" aria-hidden="true"></span></a>
      </div>
  <div id="left-column">
    <div class="sphinxsidebar"><a href="
    ../../README.html" class="text-logo">DesignPatternsPHP</a>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <h2>Table Of Contents</h2>
  </div>
  <div class="sidebar-toc">
    
    
      <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../Creational/README.html">1. Creational</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../README.html">2. Structural</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../Adapter/README.html">2.1. Adapter / Wrapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Bridge/README.html">2.2. Bridge</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Composite/README.html">2.3. Composite</a></li>
<li class="toctree-l2"><a class="reference internal" href="../DataMapper/README.html">2.4. Data Mapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Decorator/README.html">2.5. Decorator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../DependencyInjection/README.html">2.6. Dependency Injection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Facade/README.html">2.7. Facade</a></li>
<li class="toctree-l2"><a class="reference internal" href="../FluentInterface/README.html">2.8. Fluent Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Flyweight/README.html">2.9. Flyweight</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Proxy/README.html">2.10. Proxy</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">2.11. Registry</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../Behavioral/README.html">3. Behavioral</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../More/README.html">4. More</a></li>
</ul>

    
  </div>
</div>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <div id="main-search">
      <form class="form-inline" action="../../search.html" method="GET" role="form">
        <div class="input-group">
          <input name="q" type="text" class="form-control" placeholder="Search...">
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div>
      
    </div>
  </div>
        <div id="right-column">
          
          <div role="navigation" aria-label="breadcrumbs navigation">
            <ol class="breadcrumb">
              <li><a href="../../README.html">Docs</a></li>
              
                <li><a href="../README.html">2. Structural</a></li>
              
              <li>2.11. Registry</li>
            </ol>
          </div>
          
          <div class="document clearer body">
            
  <div class="section" id="registry">
<h1>2.11. <a class="reference external" href="http://en.wikipedia.org/wiki/Service_locator_pattern">Registry</a><a class="headerlink" href="#registry" title="Permalink to this headline">¶</a></h1>
<div class="section" id="purpose">
<h2>2.11.1. Purpose<a class="headerlink" href="#purpose" title="Permalink to this headline">¶</a></h2>
<p>To implement a central storage for objects often used throughout the
application, is typically implemented using an abstract class with only
static methods (or using the Singleton pattern). Remember that this introduces
global state, which should be avoided at all times! Instead implement it using Dependency Injection!</p>
</div>
<div class="section" id="examples">
<h2>2.11.2. Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Zend Framework 1: <code class="docutils literal"><span class="pre">Zend_Registry</span></code> holds the application’s logger
object, front controller etc.</li>
<li>Yii Framework: <code class="docutils literal"><span class="pre">CWebApplication</span></code> holds all the application
components, such as <code class="docutils literal"><span class="pre">CWebUser</span></code>, <code class="docutils literal"><span class="pre">CUrlManager</span></code>, etc.</li>
</ul>
</div>
<div class="section" id="uml-diagram">
<h2>2.11.3. UML Diagram<a class="headerlink" href="#uml-diagram" title="Permalink to this headline">¶</a></h2>
<img alt="Alt Registry UML Diagram" class="align-center" src="../../_images/uml35.png" />
</div>
<div class="section" id="code">
<h2>2.11.4. Code<a class="headerlink" href="#code" title="Permalink to this headline">¶</a></h2>
<p>You can also find this code on <a class="reference external" href="https://github.com/domnikl/DesignPatternsPHP/tree/master/Structural/Registry">GitHub</a></p>
<p>Registry.php</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Registry</span><span class="p">;</span>

<span class="k">abstract</span> <span class="k">class</span> <span class="nc">Registry</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="no">LOGGER</span> <span class="o">=</span> <span class="s1">&#39;logger&#39;</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * this introduces global state in your application which can not be mocked up for testing</span>
<span class="sd">     * and is therefor considered an anti-pattern! Use dependency injection instead!</span>
<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="k">static</span> <span class="nv">$storedValues</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="sd">/**</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="k">static</span> <span class="nv">$allowedKeys</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nx">self</span><span class="o">::</span><span class="na">LOGGER</span><span class="p">,</span>
    <span class="p">];</span>

    <span class="sd">/**</span>
<span class="sd">     * @param string $key</span>
<span class="sd">     * @param mixed  $value</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">set</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$key</span><span class="p">,</span> <span class="nv">$value</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nx">self</span><span class="o">::</span><span class="nv">$allowedKeys</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">\InvalidArgumentException</span><span class="p">(</span><span class="s1">&#39;Invalid key given&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nx">self</span><span class="o">::</span><span class="nv">$storedValues</span><span class="p">[</span><span class="nv">$key</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$value</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @param string $key</span>
<span class="sd">     *</span>
<span class="sd">     * @return mixed</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">get</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$key</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nx">self</span><span class="o">::</span><span class="nv">$allowedKeys</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="nv">$storedValues</span><span class="p">[</span><span class="nv">$key</span><span class="p">]))</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">\InvalidArgumentException</span><span class="p">(</span><span class="s1">&#39;Invalid key given&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="nv">$storedValues</span><span class="p">[</span><span class="nv">$key</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="test">
<h2>2.11.5. Test<a class="headerlink" href="#test" title="Permalink to this headline">¶</a></h2>
<p>Tests/RegistryTest.php</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Registry\Tests</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">DesignPatterns\Structural\Registry\Registry</span><span class="p">;</span>
<span class="k">use</span> <span class="k">stdClass</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">RegistryTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testSetAndGetLogger</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$key</span> <span class="o">=</span> <span class="nx">Registry</span><span class="o">::</span><span class="na">LOGGER</span><span class="p">;</span>
        <span class="nv">$logger</span> <span class="o">=</span> <span class="k">new</span> <span class="k">stdClass</span><span class="p">();</span>

        <span class="nx">Registry</span><span class="o">::</span><span class="na">set</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$logger</span><span class="p">);</span>
        <span class="nv">$storedLogger</span> <span class="o">=</span> <span class="nx">Registry</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="nv">$key</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="nv">$logger</span><span class="p">,</span> <span class="nv">$storedLogger</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertInstanceOf</span><span class="p">(</span><span class="k">stdClass</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$storedLogger</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @expectedException \InvalidArgumentException</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testThrowsExceptionWhenTryingToSetInvalidKey</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Registry</span><span class="o">::</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;foobar&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="k">stdClass</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * notice @runInSeparateProcess here: without it, a previous test might have set it already and</span>
<span class="sd">     * testing would not be possible. That&#39;s why you should implement Dependency Injection where an</span>
<span class="sd">     * injected class may easily be replaced by a mockup</span>
<span class="sd">     *</span>
<span class="sd">     * @runInSeparateProcess</span>
<span class="sd">     * @expectedException \InvalidArgumentException</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testThrowsExceptionWhenTryingToGetNotSetKey</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Registry</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="nx">Registry</span><span class="o">::</span><span class="na">LOGGER</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>


          </div>
            
  <div class="footer-relations">
    
      <div class="pull-left">
        <a class="btn btn-default" href="../Proxy/README.html" title="previous chapter (use the left arrow)">2.10. Proxy</a>
      </div>
    
      <div class="pull-right">
        <a class="btn btn-default" href="../../Behavioral/README.html" title="next chapter (use the right arrow)">3. Behavioral</a>
      </div>
    </div>
    <div class="clearer"></div>
  
        </div>
        <div class="clearfix"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../Behavioral/README.html" title="3. Behavioral"
             >next</a> |</li>
        <li class="right" >
          <a href="../Proxy/README.html" title="2.10. Proxy"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../README.html">DesignPatternsPHP 1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../README.html" >2. Structural</a> &#187;</li> 
      </ul>
    </div>
<script type="text/javascript">
  $("#mobile-toggle a").click(function () {
    $("#left-column").toggle();
  });
</script>
<script type="text/javascript" src="../../_static/js/bootstrap.js"></script>
  <div class="footer">
    &copy; Copyright 2015, Dominik Liebler and contributors. Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div>
  </body>
</html>