
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
  
  <!-- Licensed under the Apache 2.0 License -->
  <link rel="stylesheet" type="text/css" href="../../_static/fonts/open-sans/stylesheet.css" />
  <!-- Licensed under the SIL Open Font License -->
  <link rel="stylesheet" type="text/css" href="../../_static/fonts/source-serif-pro/source-serif-pro.css" />
  <link rel="stylesheet" type="text/css" href="../../_static/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="../../_static/css/bootstrap-theme.min.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
    <title>4.2. Service Locator &#8212; DesignPatternsPHP 1.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/guzzle.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="4.3. Repository" href="../Repository/README.html" />
    <link rel="prev" title="4.1. Delegation" href="../Delegation/README.html" />
  
   

  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../Repository/README.html" title="4.3. Repository"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../Delegation/README.html" title="4.1. Delegation"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../README.html">DesignPatternsPHP 1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../README.html" accesskey="U">4. More</a> &#187;</li> 
      </ul>
    </div>
    <div class="container-wrapper">

      <div id="mobile-toggle">
        <a href="#"><span class="glyphicon glyphicon-align-justify" aria-hidden="true"></span></a>
      </div>
  <div id="left-column">
    <div class="sphinxsidebar"><a href="
    ../../README.html" class="text-logo">DesignPatternsPHP</a>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <h2>Table Of Contents</h2>
  </div>
  <div class="sidebar-toc">
    
    
      <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../Creational/README.html">1. Creational</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Structural/README.html">2. Structural</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Behavioral/README.html">3. Behavioral</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../README.html">4. More</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../Delegation/README.html">4.1. Delegation</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">4.2. Service Locator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Repository/README.html">4.3. Repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="../EAV/README.html">4.4. Entity-Attribute-Value (EAV)</a></li>
</ul>
</li>
</ul>

    
  </div>
</div>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <div id="main-search">
      <form class="form-inline" action="../../search.html" method="GET" role="form">
        <div class="input-group">
          <input name="q" type="text" class="form-control" placeholder="Search...">
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div>
      
    </div>
  </div>
        <div id="right-column">
          
          <div role="navigation" aria-label="breadcrumbs navigation">
            <ol class="breadcrumb">
              <li><a href="../../README.html">Docs</a></li>
              
                <li><a href="../README.html">4. More</a></li>
              
              <li>4.2. Service Locator</li>
            </ol>
          </div>
          
          <div class="document clearer body">
            
  <div class="section" id="service-locator">
<h1>4.2. <a class="reference external" href="http://en.wikipedia.org/wiki/Service_locator_pattern">Service Locator</a><a class="headerlink" href="#service-locator" title="Permalink to this headline">¶</a></h1>
<p><strong>THIS IS CONSIDERED TO BE AN ANTI-PATTERN!</strong></p>
<p>Service Locator is considered for some people an anti-pattern. It violates the Dependency Inversion principle.
Service Locator hides class’ dependencies instead of exposing them as you would do using the Dependency Injection. In case of changes of those dependencies you risk to break the functionality of classes which are using them, making your system difficult to maintain.</p>
<div class="section" id="purpose">
<h2>4.2.1. Purpose<a class="headerlink" href="#purpose" title="Permalink to this headline">¶</a></h2>
<p>To implement a loosely coupled architecture in order to get better
testable, maintainable and extendable code. DI pattern and Service
Locator pattern are an implementation of the Inverse of Control pattern.</p>
</div>
<div class="section" id="usage">
<h2>4.2.2. Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>With <code class="docutils literal"><span class="pre">ServiceLocator</span></code> you can register a service for a given
interface. By using the interface you can retrieve the service and use
it in the classes of the application without knowing its implementation.
You can configure and inject the Service Locator object on bootstrap.</p>
</div>
<div class="section" id="examples">
<h2>4.2.3. Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Zend Framework 2 uses Service Locator to create and share services
used in the framework(i.e. EventManager, ModuleManager, all custom
user services provided by modules, etc…)</li>
</ul>
</div>
<div class="section" id="uml-diagram">
<h2>4.2.4. UML Diagram<a class="headerlink" href="#uml-diagram" title="Permalink to this headline">¶</a></h2>
<img alt="Alt ServiceLocator UML Diagram" class="align-center" src="../../_images/uml24.png" />
</div>
<div class="section" id="code">
<h2>4.2.5. Code<a class="headerlink" href="#code" title="Permalink to this headline">¶</a></h2>
<p>You can also find this code on <a class="reference external" href="https://github.com/domnikl/DesignPatternsPHP/tree/master/More/ServiceLocator">GitHub</a></p>
<p>ServiceLocator.php</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\More\ServiceLocator</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ServiceLocator</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nv">$services</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="sd">/**</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nv">$instantiated</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="sd">/**</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nv">$shared</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="sd">/**</span>
<span class="sd">     * instead of supplying a class here, you could also store a service for an interface</span>
<span class="sd">     *</span>
<span class="sd">     * @param string $class</span>
<span class="sd">     * @param object $service</span>
<span class="sd">     * @param bool $share</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">addInstance</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$class</span><span class="p">,</span> <span class="nv">$service</span><span class="p">,</span> <span class="nx">bool</span> <span class="nv">$share</span> <span class="o">=</span> <span class="k">true</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">services</span><span class="p">[</span><span class="nv">$class</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$service</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">instantiated</span><span class="p">[</span><span class="nv">$class</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$service</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">shared</span><span class="p">[</span><span class="nv">$class</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$share</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * instead of supplying a class here, you could also store a service for an interface</span>
<span class="sd">     *</span>
<span class="sd">     * @param string $class</span>
<span class="sd">     * @param array $params</span>
<span class="sd">     * @param bool $share</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">addClass</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$class</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$params</span><span class="p">,</span> <span class="nx">bool</span> <span class="nv">$share</span> <span class="o">=</span> <span class="k">true</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">services</span><span class="p">[</span><span class="nv">$class</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$params</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">shared</span><span class="p">[</span><span class="nv">$class</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$share</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">has</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$interface</span><span class="p">)</span><span class="o">:</span> <span class="nx">bool</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">services</span><span class="p">[</span><span class="nv">$interface</span><span class="p">])</span> <span class="o">||</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">instantiated</span><span class="p">[</span><span class="nv">$interface</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @param string $class</span>
<span class="sd">     *</span>
<span class="sd">     * @return object</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">get</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$class</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">instantiated</span><span class="p">[</span><span class="nv">$class</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">shared</span><span class="p">[</span><span class="nv">$class</span><span class="p">])</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">instantiated</span><span class="p">[</span><span class="nv">$class</span><span class="p">];</span>
        <span class="p">}</span>

        <span class="nv">$args</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">services</span><span class="p">[</span><span class="nv">$class</span><span class="p">];</span>

        <span class="k">switch</span> <span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$args</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
                <span class="nv">$object</span> <span class="o">=</span> <span class="k">new</span> <span class="nv">$class</span><span class="p">();</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
                <span class="nv">$object</span> <span class="o">=</span> <span class="k">new</span> <span class="nv">$class</span><span class="p">(</span><span class="nv">$args</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
                <span class="nv">$object</span> <span class="o">=</span> <span class="k">new</span> <span class="nv">$class</span><span class="p">(</span><span class="nv">$args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
                <span class="nv">$object</span> <span class="o">=</span> <span class="k">new</span> <span class="nv">$class</span><span class="p">(</span><span class="nv">$args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">default</span><span class="o">:</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nx">\OutOfRangeException</span><span class="p">(</span><span class="s1">&#39;Too many arguments given&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">shared</span><span class="p">[</span><span class="nv">$class</span><span class="p">])</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">instantiated</span><span class="p">[</span><span class="nv">$class</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$object</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$object</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>LogService.php</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\More\ServiceLocator</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">LogService</span>
<span class="p">{</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="test">
<h2>4.2.6. Test<a class="headerlink" href="#test" title="Permalink to this headline">¶</a></h2>
<p>Tests/ServiceLocatorTest.php</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\More\ServiceLocator\Tests</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">DesignPatterns\More\ServiceLocator\LogService</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\More\ServiceLocator\ServiceLocator</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ServiceLocatorTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @var ServiceLocator</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nv">$serviceLocator</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">serviceLocator</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ServiceLocator</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testHasServices</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">serviceLocator</span><span class="o">-&gt;</span><span class="na">addInstance</span><span class="p">(</span><span class="nx">LogService</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="k">new</span> <span class="nx">LogService</span><span class="p">());</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">serviceLocator</span><span class="o">-&gt;</span><span class="na">has</span><span class="p">(</span><span class="nx">LogService</span><span class="o">::</span><span class="na">class</span><span class="p">));</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertFalse</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">serviceLocator</span><span class="o">-&gt;</span><span class="na">has</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="na">class</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testGetWillInstantiateLogServiceIfNoInstanceHasBeenCreatedYet</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">serviceLocator</span><span class="o">-&gt;</span><span class="na">addClass</span><span class="p">(</span><span class="nx">LogService</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="p">[]);</span>
        <span class="nv">$logger</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">serviceLocator</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="nx">LogService</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertInstanceOf</span><span class="p">(</span><span class="nx">LogService</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$logger</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>


          </div>
            
  <div class="footer-relations">
    
      <div class="pull-left">
        <a class="btn btn-default" href="../Delegation/README.html" title="previous chapter (use the left arrow)">4.1. Delegation</a>
      </div>
    
      <div class="pull-right">
        <a class="btn btn-default" href="../Repository/README.html" title="next chapter (use the right arrow)">4.3. Repository</a>
      </div>
    </div>
    <div class="clearer"></div>
  
        </div>
        <div class="clearfix"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../Repository/README.html" title="4.3. Repository"
             >next</a> |</li>
        <li class="right" >
          <a href="../Delegation/README.html" title="4.1. Delegation"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../README.html">DesignPatternsPHP 1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../README.html" >4. More</a> &#187;</li> 
      </ul>
    </div>
<script type="text/javascript">
  $("#mobile-toggle a").click(function () {
    $("#left-column").toggle();
  });
</script>
<script type="text/javascript" src="../../_static/js/bootstrap.js"></script>
  <div class="footer">
    &copy; Copyright 2015, Dominik Liebler and contributors. Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div>
  </body>
</html>